---
title: "Riesgo de Homicidio en Medellín"
output: html_notebook
---
# Andrés Felipe García Orrego - Juan Pablo Robledo Meza
# Introducción
La violecia en Medellín es un problema de larga data, el cual ha tenido momentos criticos que han generado grandes procesos sociales en la ciudad sin embargo esto no se ve reflejado en modelos basados en datos para la construccion de politicas publicas orientadas a un manejo mas tecnico de los delitos violentos en la ciudad, en particular los homicidios son crimenes razonablemente bien documentados y de alto impacto para la opinión publica y la ciudad, por lo cual decidimos construir un **Modelo espacio-temporal bayesiano** que estime el riesgo de homicidio usando INLA.
Con el fin de responer las siguientes preguntas:

# Preguntas
  - **Riesgo de homicidio en un lugar de Medellín**.
  - **Puntos calientes.**
  - **¿Cuando hay mas riesgo?**
  - **Presencia policial vs riesgo.**
  - **Metricas para estos tipos de modelos.**
  
# Limpieza y Preparación de los Datos de Homicidios en Medellín:

Para garantizar la calidad y pertinencia de los datos en nuestro análisis del riesgo de homicidios en Medellín, realizamos un proceso de limpieza de la base de datos descargada de MeData, que contenía 19,647 registros y 36 columnas.

## Eliminación de Columnas Irrelevantes

Identificamos columnas con valores únicos o sin información relevante para el análisis:

**Columnas con valores constantes**: (CANTIDAD, CONDUCTA, FECHA_INGESTION)

**Columnas con alta cantidad de valores NA**: (GRUPO_ACTOR, ACTIVIDAD_DELICTIVA, DISCAPACIDAD, TESTIGO, entre otras)


Todas estas columnas fueron eliminadas, ya que no aportaban información adicional.

## Selección de Variables Clave.

Tras la limpieza, seleccionamos las variables más relevantes para el análisis:
- LATITUD, LONGITUD → Ubicación geográfica del homicidio.


- SEXO, EDAD → Características de la víctima.


- MODALIDAD → Forma en que ocurrió el hecho.

- NOMBRE_BARRIO, CODIGO_BARRIO, CODIGO_COMUNA  Ubicación administrativa.

- LUGAR → Tipo de espacio donde ocurrió el homicidio.

Con estos datos estructurados, podemos proceder al análisis espacio-temporal del riesgo de homicidios en la ciudad.

## Resultado

Teniendo finalmente **18516 registros y 10 columnas**

# Primer análisis
```{r}
library(ggplot2)
library(dplyr)
library(lubridate)
library(readr)
library(forcats)
library(sf)
library(ggmap)
library(ggspatial)
library(RColorBrewer)
```

```{r}
medellin_mapa <- st_read("data/limite_catastral_de_comun/limite_catastral_de_comun.shp")
```


## Homicidios
```{r}
homicidios <- read.csv("data/homicidios.csv")

# Para analisis temporal
homicidios$FECHA_HECHO <- ymd_hms(homicidios$FECHA_HECHO)
homicidios$AÑO <- year(homicidios$FECHA_HECHO)
homicidios$MES <- month(homicidios$FECHA_HECHO, label = TRUE, abbr = TRUE)

summary(homicidios)
```

### Generalidades
#### Modalidad de Homicidio
```{r}
ggplot(homicidios, aes(y = fct_infreq(MODALIDAD))) +
  geom_bar(fill = "purple") +
  theme_minimal() +
  labs(title = "Frecuencia de homicidios por modalidad", x = "Cantidad", y = "Modalidad")
```

#### Homicidios por género
```{r}
ggplot(homicidios, aes(x = SEXO)) +
  geom_bar(fill = "orange") +
  theme_minimal() +
  labs(title = "Distribución de homicidios por género", x = "Género", y = "Cantidad")
```

#### Distribución edad de las víctimas
```{r}
ggplot(homicidios, aes(x = EDAD)) +
  geom_histogram(bins = 30, fill = "blue", alpha = 0.7) +
  theme_minimal() +
  labs(title = "Distribución de la edad de las víctimas", x = "Edad", y = "Frecuencia")
```


### Análisis Temporal
#### Homicidios por año
```{r}
ggplot(homicidios, aes(x = as.factor(AÑO))) +
  geom_bar(fill = "steelblue") +
  theme_minimal() +
  labs(title = "Número de homicidios por año", x = "Año", y = "Cantidad de homicidios")
```

#### Homicidios por mes del año
```{r}
ggplot(homicidios, aes(x = MES)) +
  geom_bar(fill = "darkred") +
  theme_minimal() +
  labs(title = "Número de homicidios por mes", x = "Mes", y = "Cantidad de homicidios")
```

### Análisis espacial
```{r}
homicidios_sf <- st_as_sf(homicidios, coords = c("LONGITUD", "LATITUD"), crs = 4326)
```

#### Distribución de Homicidios por modalidad
```{r}
ggplot() +
  geom_sf(data = medellin_mapa, fill = "gray90", color = "black") +  # Mapa base
  geom_sf(data = homicidios_sf, aes(color = MODALIDAD), alpha = 0.6) +  # Homicidios
  scale_color_brewer(palette = "Paired") +  # Paleta de colores con 11 categorías
  theme_minimal() +
  labs(title = "Mapa de homicidios por modalidad", color = "Modalidad") +
  annotation_scale(location = "br") + 
  annotation_north_arrow(location = "tl", which_north = "true", style = north_arrow_fancy_orienteering)
```

## Cuadrantes de Policía
```{r}
# FALTA QUE DANIEL NOS PASE LOS DATOS
```






# Modelo Estadístico
  Nos basaremos en el documento https://www.dspace.espol.edu.ec/bitstream/123456789/56598/1/T-110414%20CLAUDIA%20RODR%C3%8DGUEZ%20MENDEZ%20Y%20SAMANTHA%20ORTIZ%20SANTAMARIA%20INGENIERA%20ESTADISTICA.pdf?.com. En el cual se propone un modelo similar para la cuidadd de Guayaquil en ecuador, debido a que encontramos caracteristicas importantes en comun, entre ellas el numero de habitantes y el tamaño del area metropolitana. Ademas de condiciones cultares, sociales y delictivas similares
 El modelo seguirá un enfoque **jerárquico bayesiano**, con una **distribución Poisson** para los homicidios y un predictor que incluye efectos espaciales, temporales y covariables por ultimo la estimación se hara siguiendo el metodo INLA (El cual resulta más rápido para modelos espacio temporales). 
 
$$Y_{i,t}= Poisson(\lambda_{i,t})$$.

Donde: 
- $Y_{i,t}$ es el número de homicidios en la comuna i en el tiempo t 


- $\lambda_{i,t}$ es la **Tasa esperada de homicidios** en la comuna i en el tiempo t


Nuestro modelo lineal predictor se define como:


 $log(\lambda_{i,t})=\beta_0+\beta_{policia}x_{policia,i,t}+f(espacio)+f(tiempo)+f(espacio-tiempo)$
 
 Donde:
 
$\beta_0$: Intercepto general


$x_{policia,i,t}$: Cantidad de estaciones de policia en la comuna i en el tiempo t


$\beta_{policia}$: Efecto de la presencia policial sobre los homicidios
 
 
$f(espacio)$: Efecto espacial que modela **dependencias geográficas**


$f(tiempo$: Efecto temporal que captura **tendencias en el  tiempo** (Puede ser una serie de tiempo)


$f(espacio-tiempo)$: Interacción espacio temporal para modelar **cómo varían los homicidios de cada comuna a lo largo del tiempo**


# Siguientes pasos:
- Obtener datos poblacionales de las comunas.
- Obtener información acerca de los cuadrante.
- Análisis bivariado de los datos.
- Implementar INLA
- Analizar resultados y storing telling
```{r}
 
```

